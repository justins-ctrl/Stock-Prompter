<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Trade Prompter</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #0e1117;
  color: #e6e6e6;
  padding: 20px;
}
h1 { text-align: center; margin-bottom: 20px; }
input, select, button {
  width: 100%;
  padding: 14px;
  margin-top: 10px;
  border-radius: 10px;
  border: none;
  font-size: 16px;
}
input, select {
  background: #161b22;
  color: white;
}
button {
  background: #2563eb;
  color: white;
  font-weight: bold;
}
.card {
  background: #161b22;
  padding: 16px;
  margin-top: 15px;
  border-radius: 14px;
}
.bullish { color: #22c55e; }
.bearish { color: #ef4444; }
.neutral { color: #9ca3af; }
small { color: #9ca3af; }
</style>
</head>

<body>

<h1>üìà Trade Prompter</h1>

<input id="tickerInput" placeholder="Ticker (AAPL, TSLA, SPY)" />
<button onclick="runScan()">Analyze</button>

<select id="strategy">
  <option value="scalp">Scalp (0‚Äì1 days)</option>
  <option value="weekly">Weekly Options</option>
  <option value="biweekly">Bi-Weekly Options</option>
</select>

<input id="accountSize" placeholder="Account size (e.g. 5000)" />

<label style="display:block;margin-top:10px;">
  <input type="checkbox" id="alertsOn" checked />
  Enable Alerts
</label>

<div id="results"></div>

<script>
let lastAlert = "";

function marketOpen() {
  const d = new Date();
  const h = d.getHours();
  const m = d.getMinutes();
  return (h > 9 || (h === 9 && m >= 30)) && h < 16;
}

function rsi(prices, period = 14) {
  let gains = 0, losses = 0;
  for (let i = prices.length - period; i < prices.length - 1; i++) {
    const diff = prices[i + 1] - prices[i];
    diff >= 0 ? gains += diff : losses -= diff;
  }
  const rs = gains / (losses || 1);
  return 100 - (100 / (1 + rs));
}

async function fetchPriceData(ticker) {
  const url = `https://corsproxy.io/?https://query1.finance.yahoo.com/v8/finance/chart/${ticker}?range=1d&interval=5m`;
  const res = await fetch(url);
  const json = await res.json();
  const q = json.chart.result[0].indicators.quote[0];
  return {
    prices: q.close.filter(Boolean),
    volumes: q.volume.filter(Boolean)
  };
}

function buildOptionSuggestion(price, change, rsiVal, strategy, account) {
  let expiration = "Weekly";
  if (strategy === "biweekly") expiration = "Bi-Weekly";

  let risk = "Small";
  if (account > 10000) risk = "Medium";
  if (account > 25000) risk = "Large";

  let bias = "WAIT";
  if (change > 0.4 && rsiVal < 70) bias = "CALL";
  if (change < -0.4 && rsiVal > 30) bias = "PUT";

  const confidence = Math.min(
    100,
    Math.abs(change) * 40 + (50 - Math.abs(50 - rsiVal))
  );

  return { bias, expiration, risk, confidence };
}

async function runScan() {
  const ticker = document.getElementById("tickerInput").value.trim().toUpperCase();
  const strategy = document.getElementById("strategy").value;
  const account = Number(document.getElementById("accountSize").value || 5000);
  const alertsOn = document.getElementById("alertsOn").checked;
  const results = document.getElementById("results");

  if (!ticker) return;

  results.innerHTML = `<div class="card">üîç Scanning ${ticker}‚Ä¶</div>`;

  try {
    const { prices, volumes } = await fetchPriceData(ticker);
    const current = prices.at(-1);
    const open = prices[0];
    const change = ((current - open) / open) * 100;
    const rsiVal = rsi(prices);

    const option = buildOptionSuggestion(current, change, rsiVal, strategy, account);

    let cls = "neutral";
    if (option.bias === "CALL") cls = "bullish";
    if (option.bias === "PUT") cls = "bearish";

    const signalText = `${ticker} ${option.bias} ${option.expiration}`;

    if (
      alertsOn &&
      marketOpen() &&
      option.confidence > 65 &&
      signalText !== lastAlert
    ) {
      lastAlert = signalText;
      alert(signalText);
      if ("Notification" in window && Notification.permission === "granted") {
        new Notification("Trade Prompter", { body: signalText });
      }
    }

    results.innerHTML = `
      <div class="card">
        <strong>${ticker}</strong><br>
        Price: $${current.toFixed(2)} (${change.toFixed(2)}%)<br>
        RSI: ${rsiVal.toFixed(1)}<br><br>
        <span class="${cls}">
          <strong>${option.bias} ${option.expiration}</strong>
        </span><br>
        Confidence: ${option.confidence.toFixed(0)}%<br>
        Suggested Risk: ${option.risk}
      </div>
    `;

  } catch {
    results.innerHTML = `<div class="card">Error loading data</div>`;
  }
}

if ("Notification" in window) {
  Notification.requestPermission();
}

setInterval(runScan, 120000);
</script>

</body>
</html>
